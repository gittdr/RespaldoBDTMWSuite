SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[sp_insertaexpirations_JR] @Usuario varchar(4) as
/*
INPUT PARMS:

tollfilter:  This input parm determines what to look the tolls up by
Valid values:  
1) 'O'      Order
2) 'L'      Trip Segment

@number:		key to lookup
*/

Declare @CAJAS table(
ID_Caja varchar(10))

declare	@V_ID_Caja   varchar(10)

--Lookup by order for invoicing

if @Usuario = 'JRLR'
begin
	insert into @CAJAS (ID_Caja)
				select trl_number from trailerprofile where trl_number in ('764835.',
'270019',
'CAZA102',
'CAZA201',
'CAZA103',
'CAZA105',
'CAZA202',
'CAZA203',
'TB2',
'CH48051T',
'3300',
'713306.',
'CH48005T',
'CH28051T',
'CH40079T',
'CH40056T',
'CH40025P',
'CH28064T',
'CH28003T',
'CH48007T',
'CH40001T',
'713489.',
'715137',
'557322.',
'274473',
'677193',
'765212',
'462481',
'3194',
'3116.',
'3015',
'926003',
'36278',
'3003',
'678449',
'677077',
'677699',
'683418',
'766450',
'925965',
'104LIV',
'135LIV',
'148LIV',
'159LIV',
'166LIV',
'191LIV',
'195LIV',
'40LIV',
'9LIV',
'1165',
'3272',
'3275',
'557581',
'686624',
'713275',
'713304.',
'713471',
'714936',
'807202',
'811659',
'863174',
'873271',
'557773',
'557341',
'28',
'61',
'72',
'74',
'78',
'101',
'202',
'258',
'280',
'281',
'283',
'284',
'677144',
'764763.',
'231241',
'232045',
'232141',
'232239',
'232302',
'234004',
'234081',
'234187',
'234263',
'234379',
'234452',
'234500',
'234607',
'234714',
'234751',
'234761',
'234764',
'234177',
'231257',
'231146',
'234747',
'234374',
'232081',
'232446',
'232372',
'232151',
'234016',
'234100',
'234394',
'234049',
'234036',
'232123',
'232032',
'232231',
'232432',
'232437',
'232197',
'232271',
'AT2668',
'LIV376',
'5',
'111.',
'212',
'234',
'102LIV',
'10LIV',
'124LIV',
'12LIV',
'194LIV',
'209LIV',
'219LIV',
'232LIV',
'233LIV',
'242LIV',
'248LIV',
'45LIV',
'73LIV',
'83LIV',
'179',
'60',
'29',
'41',
'73',
'241',
'134',
'129',
'147',
'183',
'435433.',
'678221.',
'IL751',
'RE1128',
'677131',
'251',
'TB1',
'433401.',
'713296.',
'6',
'232330',
'87',
'138',
'142',
'148',
'151',
'168',
'180',
'197',
'198',
'206',
'218',
'222',
'235',
'244',
'260',
'264',
'268',
'276',
'278',
'285',
'287',
'289',
'290',
'1025',
'1043',
'37011',
'37113',
'40109',
'46238',
'65379',
'67981',
'232136',
'435378.',
'557508',
'713227.',
'713297.',
'713299.',
'713457.',
'716953.',
'TRA1240',
'TRA1256',
'WER,6805',
'69768',
'39326',
'55555',
'30915',
'39799',
'46146',
'49423',
'24',
'1315.',
'9989',
'48573',
'48684',
'49192',
'69428',
'188003',
'226508',
'234774',
'274473.',
'557799',
'557800',
'677156',
'724462.',
'764741.',
'765315',
'765338',
'813100',
'999938',
'UNKNOWN',
'923903.',
'807198.',
'435444.',
'764848.',
'764774.',
'435381.',
'T538158',
'683454.',
'764746',
'714980.',
'557393',
'680824',
'686739.',
'714989.',
'765274',
'807196.',
'807185',
'587484.',
'124462',
'925086.',
'764810.',
'557502.',
'557566.',
'927525.',
'686741.',
'716995.',
'764816.',
'683369',
'274462',
'680682.',
'485366.',
'557493.',
'768604.',
'716943.',
'683428',
'557485.',
'764792',
'717047.',
'557453',
'764801.',
'768610.',
'T538158',
'923903.',
'716995.',
'387490',
'716943.',
'435372.',
'778162',
'686727,',
'764848.',
'764816.',
'557327.',
'925072',
'485366.',
'925949.',
'557493.',
'686721.',
'557566.',
'587484.',
'795231',
'807198.',
'435397.',
'764765.',
'557502.',
'124462',
'764745',
'925086.',
'927554.',
'764750',
'680682.',
'123794.',
'927525.',
'807174.',
'686741.',
'435444.',
'764733',
'807196.',
'764801.',
'764744',
'764741',
'717132.',
'764747.',
'764810.',
'768604.',
'764738',
'764774.',
'776159.',
'768610.',
'764769.',
'683454.',
'764732',
'435381.',
'764786.',
'807178',
'764746',
'714980.',
'807210',
'557393',
'680595.',
'764792',
'557395',
'971339',
'764779.',
'765274',
'683484.',
'678455',
'717047.',
'925104',
'683369',
'680824',
'683428',
'683462.',
'678443',
'557453',
'764778',
'765302',
'274462',
'680825',
'686739.',
'686742.',
'714989.',
'557485.',
'557504',
'765344',
'270020',
'587490.',
'713312',
'686728.',
'677812',
'807185',
'768603')

end
--Recorre cada uno de los renglones de las cajas

If Exists ( Select count(*) From  @CAJAS )
	BEGIN -- 1 inicio del barrido de los operadores...
		-- Se declara un curso para ir leyendo la tabla de paso
		DECLARE cajas_Cursor CURSOR FOR 
		SELECT ID_Caja
		FROM @Cajas 
	
		OPEN cajas_Cursor 
		FETCH NEXT FROM cajas_Cursor INTO @V_ID_caja
		WHILE @@FETCH_STATUS = 0 
		BEGIN --2 del cursor operadores_Cursor --2

			SELECT @V_ID_caja

				INSERT INTO  TMWsuite.dbo.expiration
				( exp_idtype,   exp_id,   exp_code,   exp_lastdate,   exp_expirationdate,   
				  exp_routeto,  exp_completed,  exp_priority,   exp_compldate,   exp_updateby,   
				exp_creatdate,   exp_updateon,   exp_description, exp_milestoexp,    
				exp_city,   mov_number,   exp_control_avl_date,   skip_trigger )  

				  VALUES ( 'TRL',  @V_ID_caja,   'OUT',   '2013-05-17 10:01',  '2013-05-17 10:01',  
					   'UNKNOWN', 'N',   1, '2049-12-31 23:59:00.000', 'JRLR',   
						   '2013-05-17 10:01', '2013-05-17 10:01', 'Fuera de Servicio en Autom√°tico',  Null,
						   0,    null,   'N',  null );


			FETCH NEXT FROM cajas_Cursor INTO @V_ID_caja
		
		END --2

	CLOSE cajas_Cursor 
	DEALLOCATE cajas_Cursor 

END --1

--END







GO
